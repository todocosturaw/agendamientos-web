<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Horarios del Curso</title>
</head>
<body>

<h2>Horarios disponibles</h2>

<button id="btnHorarios">Ver horarios</button>

<br><br>

<label>Fecha:</label>
<select id="fecha"></select>

<br><br>

<label>Horario:</label>
<select id="hora"></select>

<script>
const params = new URLSearchParams(location.search);
const course_id = params.get("course_id");

let horarios = [];

document.getElementById("btnHorarios").onclick = async () => {
  const res = await fetch(
    `https://api.taller2.workers.dev/api/horarios?course_id=${course_id}`
  );
  const json = await res.json();
  horarios = json.horarios;
  cargarFechas();
};

function cargarFechas() {
  const fechas = [...new Set(horarios.map(h => h.fecha_inicio))];
  const sel = document.getElementById("fecha");
  sel.innerHTML = "";
  fechas.forEach(f => {
    const o = document.createElement("option");
    o.value = f;
    o.textContent = f;
    sel.appendChild(o);
  });
  sel.onchange();
}

document.getElementById("fecha").onchange = () => {
  const fecha = document.getElementById("fecha").value;
  const horas = horarios.filter(h => h.fecha_inicio === fecha);

  const sel = document.getElementById("hora");
  sel.innerHTML = "";
  horas.forEach(h => {
    const o = document.createElement("option");
    o.value = h.slot_id;
    o.textContent = `${h.hora_inicio} (cupos ${h.cupos_disponibles})`;
    sel.appendChild(o);
  });
};
</script>

</body>
</html>
